// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(uuid())
  nickName     String         @unique
  passwordHash String
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  status       UserStatus     @default(OFFLINE)
  /// avatarImg
  ///  wins?
  ///  losts?
  ///  eloScore?
  // MatchHistory MatchHistory[]
  // player1 MatchHistory[] @relation("player1")
  // player2 MatchHistory[] @relation("player2")

  player UserMatch[]      @relation("player")
  requester Friendship[]  @relation("requester")
  addressee Friendship[]  @relation("addressee")
}

model Friendship {
  id Int                  @id @default(autoincrement())
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  status FriendshipStatus @default(PENDING)
  requesterId String
  requester User          @relation("requester", fields: [requesterId], references: [id])
  addresseeId String
  addressee User          @relation("addressee", fields: [addresseeId], references: [id])
}

// model MatchHistory {
//   id        String   @id @default(uuid())
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

//   player1Id String
//   player1 User @relation("player1", fields: [player1Id], references: [userId])
//   player2Id String
//   player2 User @relation("player2", fields: [player2Id], references: [userId])
//   score     Json     @default("{\"player1\" : 0, \"player2\" : 0}")
// }

model Match {
  id        String        @id @default(uuid())
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  match     UserMatch[]   @relation("match")
  score     Json          @default("{\"player1\" : 0, \"player2\" : 0}")
}

model UserMatch {
  id        String        @id @default(uuid())
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  playerId  String
  player User             @relation("player", fields: [playerId], references: [id])
  matchId String
  match Match             @relation("match", fields: [matchId], references: [id])
}

enum UserStatus {
  OFFLINE
  ONLINE
  PLAYING
}

enum ChannelRole {
  DEFAULT
  ADMIN
  OWNER
}

enum ChannelType {
  PUBLIC
  PRIVATE
  PROTECTED
  DIRECTMESSAGE
}

enum FriendshipStatus {
  PENDING
  APPROVED
  REFUSED
}
